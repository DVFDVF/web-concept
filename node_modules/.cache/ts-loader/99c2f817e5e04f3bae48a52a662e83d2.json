{"remainingRequest":"/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/babel-loader/lib/index.js!/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/ts-loader/index.js??ref--15-2!/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/eslint-loader/index.js??ref--14-0!/Users/nuomi/Desktop/项目/fury-client/fury-client/src/dataCenter/siteMessage.ts","dependencies":[{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/src/dataCenter/siteMessage.ts","mtime":1718682940367},{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/babel.config.js","mtime":1716171552917},{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/cache-loader/dist/cjs.js","mtime":1716171608994},{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/babel-loader/lib/index.js","mtime":1716171609486},{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/ts-loader/index.js","mtime":1716171609531},{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/eslint-loader/index.js","mtime":1716171609105}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCB7IHN0YXRpb25NZXNzYWdlIH0gZnJvbSAnQC9hcGkvZmV0Y2hlcic7CmltcG9ydCB7IG9wZW5Ob3RpZmljYXRpb24gfSBmcm9tICdAL2NvbXBvbmVudHMvbm90aWNlL05vdGljZSc7CmltcG9ydCBjb25uLCB7IENvbm5Nb2RhbCB9IGZyb20gJ0AvbWFuYWdlci9jb25uJzsKaW1wb3J0IHsgaGF2ZVJlYWQgfSBmcm9tICdAL3ZpZXdzL2hvbWUvYXBpL25vdGlmeS1hcGkvbm90aWZ5SW5kZXgnOwppbXBvcnQgeyByZWFjdGl2ZSB9IGZyb20gJ3Z1ZSc7Ci8qKuermeWGhemAmuefpSAqLwpjbGFzcyBTaXRlTWVzc2FnZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLmxpc3QgPSBbXTsKICB9CiAgc3RhcnRMaXN0ZW4oKSB7CiAgICBjb25uLmFkZExpc3RlbmVyKENvbm5Nb2RhbC5TMkNfTUVXX01TRywgdGhpcyk7CiAgICAvLyDlpKflpZbpgJrlkYoKICAgIGNvbm4uYWRkTGlzdGVuZXIoQ29ubk1vZGFsLlMyQ19XT1JMRF9QUklaRV9CUk9BRENBU1QsIHRoaXMpOwogIH0KICBzdG9wTGlzdGVuKCkgewogICAgY29ubi5yZW1vdmVMaXN0ZW5lcihDb25uTW9kYWwuUzJDX01FV19NU0csIHRoaXMpOwogICAgLy/lpKflpZbpgJrnn6UKICAgIGNvbm4ucmVtb3ZlTGlzdGVuZXIoQ29ubk1vZGFsLlMyQ19XT1JMRF9QUklaRV9CUk9BRENBU1QsIHRoaXMpOwogIH0KICBpbml0KCkgewogICAgc3RhdGlvbk1lc3NhZ2UoKS50aGVuKHJlc3AgPT4gewogICAgICBpZiAocmVzcCkgewogICAgICAgIHRoaXMubGlzdCA9IHJlc3A7CiAgICAgIH0KICAgIH0pOwogIH0KICAvLyDpgJrnn6Xmtojmga8KICBvbkRhdGEoZGF0YSkgewogICAgaWYgKCd3aW5BbW91bnQnIGluIGRhdGEpIHsKICAgICAgLy/lpKflpZbpgJrnn6UKICAgICAgb3Blbk5vdGlmaWNhdGlvbihkYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIOmAmuefpea2iOaBrwogICAgICB0aGlzLmxpc3QucHVzaChkYXRhKTsKICAgIH0KICB9CiAgY2xlYXIoKSB7CiAgICB0aGlzLmxpc3QubGVuZ3RoID0gMDsKICB9CiAgZ2V0VW5yZWFkQ291bnQoKSB7CiAgICByZXR1cm4gdGhpcy5saXN0LmZpbHRlcihpdGVtID0+IGl0ZW0uc3RhdHVzID09PSAwKS5sZW5ndGg7CiAgfQogIGdldE1lc3NhZ2VCeVR5cGUodHlwZSkgewogICAgcmV0dXJuIHRoaXMubGlzdC5maWx0ZXIoaXRlbSA9PiBpdGVtLnR5cGUgPT09IHR5cGUpOwogIH0KICByZWFkQWxsKHR5cGUpIHsKICAgIHRoaXMubGlzdC5mb3JFYWNoKGl0ZW0gPT4gewogICAgICBpZiAoaXRlbS50eXBlID09PSB0eXBlKSB7CiAgICAgICAgaWYgKGl0ZW0uc3RhdHVzID09PSAwKSB7CiAgICAgICAgICB0aGlzLmhhdmVSZWFkTWVzc2FnZShpdGVtLmlkKTsKICAgICAgICB9CiAgICAgICAgaXRlbS5zdGF0dXMgPSAxOwogICAgICB9CiAgICB9KTsKICB9CiAgLyoq5raI5oGv5bey6K+7ICovCiAgaGF2ZVJlYWRNZXNzYWdlKG1lc3NhZ2VJZCkgewogICAgaGF2ZVJlYWQoW21lc3NhZ2VJZF0pLnRoZW4ocmVzcCA9PiB7CiAgICAgIGlmICghcmVzcCkgcmV0dXJuOwogICAgfSk7CiAgfQp9CmV4cG9ydCBjb25zdCBzaXRlTWVzc2FnZSA9IHJlYWN0aXZlKG5ldyBTaXRlTWVzc2FnZSgpKTsKc2l0ZU1lc3NhZ2Uuc3RhcnRMaXN0ZW4oKTs="},{"version":3,"names":["stationMessage","openNotification","conn","ConnModal","haveRead","reactive","SiteMessage","constructor","list","startListen","addListener","S2C_MEW_MSG","S2C_WORLD_PRIZE_BROADCAST","stopListen","removeListener","init","then","resp","onData","data","push","clear","length","getUnreadCount","filter","item","status","getMessageByType","type","readAll","forEach","haveReadMessage","id","messageId","siteMessage"],"sources":["/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/eslint-loader/index.js??ref--14-0!/Users/nuomi/Desktop/项目/fury-client/fury-client/src/dataCenter/siteMessage.ts"],"sourcesContent":["import { stationMessage } from '@/api/fetcher';\nimport { Message } from '@/api/protocol';\nimport { openNotification } from '@/components/notice/Notice';\nimport conn, { ConnModal, IConnectionListener } from '@/manager/conn';\nimport { haveRead } from '@/views/home/api/notify-api/notifyIndex';\nimport { reactive } from 'vue';\nimport { GrandPrize } from './protocol';\n\ninterface NotificationData {\n  id: number;\n  cmd: string;\n  content: string;\n  status: number;\n  time: string;\n  type: number;\n  userId: number;\n}\n\n/**站内通知 */\nclass SiteMessage implements IConnectionListener<NotificationData> {\n  list: Message[] = [];\n  startListen() {\n    conn.addListener(ConnModal.S2C_MEW_MSG, this);\n    // 大奖通告\n    conn.addListener(ConnModal.S2C_WORLD_PRIZE_BROADCAST, this);\n  }\n  stopListen() {\n    conn.removeListener(ConnModal.S2C_MEW_MSG, this);\n    //大奖通知\n    conn.removeListener(ConnModal.S2C_WORLD_PRIZE_BROADCAST, this);\n  }\n  init() {\n    stationMessage().then((resp) => {\n      if (resp) {\n        this.list = resp;\n      }\n    });\n  }\n\n  // 通知消息\n  onData(data: NotificationData | GrandPrize) {\n    if ('winAmount' in data) {\n      //大奖通知\n      openNotification(data);\n    } else {\n      // 通知消息\n      this.list.push(data);\n    }\n  }\n\n  clear() {\n    this.list.length = 0;\n  }\n\n  getUnreadCount() {\n    return this.list.filter((item) => item.status === 0).length;\n  }\n\n  getMessageByType(type: number) {\n    return this.list.filter((item) => item.type === type);\n  }\n\n  readAll(type: number) {\n    this.list.forEach((item) => {\n      if (item.type === type) {\n        if (item.status === 0) {\n          this.haveReadMessage(item.id);\n        }\n        item.status = 1;\n      }\n    });\n  }\n\n  /**消息已读 */\n  haveReadMessage(messageId: number) {\n    haveRead([messageId]).then((resp) => {\n      if (!resp) return;\n    });\n  }\n}\n\nexport const siteMessage = reactive(new SiteMessage());\nsiteMessage.startListen();\n"],"mappings":";AAAA,SAASA,cAAc,QAAQ,eAAe;AAE9C,SAASC,gBAAgB,QAAQ,4BAA4B;AAC7D,OAAOC,IAAI,IAAIC,SAAS,QAA6B,gBAAgB;AACrE,SAASC,QAAQ,QAAQ,yCAAyC;AAClE,SAASC,QAAQ,QAAQ,KAAK;AAa9B;AACA,MAAMC,WAAW;EAAjBC,YAAA;IACE,KAAAC,IAAI,GAAc,EAAE;EA2DtB;EA1DEC,WAAWA,CAAA;IACTP,IAAI,CAACQ,WAAW,CAACP,SAAS,CAACQ,WAAW,EAAE,IAAI,CAAC;IAC7C;IACAT,IAAI,CAACQ,WAAW,CAACP,SAAS,CAACS,yBAAyB,EAAE,IAAI,CAAC;EAC7D;EACAC,UAAUA,CAAA;IACRX,IAAI,CAACY,cAAc,CAACX,SAAS,CAACQ,WAAW,EAAE,IAAI,CAAC;IAChD;IACAT,IAAI,CAACY,cAAc,CAACX,SAAS,CAACS,yBAAyB,EAAE,IAAI,CAAC;EAChE;EACAG,IAAIA,CAAA;IACFf,cAAc,EAAE,CAACgB,IAAI,CAAEC,IAAI,IAAI;MAC7B,IAAIA,IAAI,EAAE;QACR,IAAI,CAACT,IAAI,GAAGS,IAAI;;IAEpB,CAAC,CAAC;EACJ;EAEA;EACAC,MAAMA,CAACC,IAAmC;IACxC,IAAI,WAAW,IAAIA,IAAI,EAAE;MACvB;MACAlB,gBAAgB,CAACkB,IAAI,CAAC;KACvB,MAAM;MACL;MACA,IAAI,CAACX,IAAI,CAACY,IAAI,CAACD,IAAI,CAAC;;EAExB;EAEAE,KAAKA,CAAA;IACH,IAAI,CAACb,IAAI,CAACc,MAAM,GAAG,CAAC;EACtB;EAEAC,cAAcA,CAAA;IACZ,OAAO,IAAI,CAACf,IAAI,CAACgB,MAAM,CAAEC,IAAI,IAAKA,IAAI,CAACC,MAAM,KAAK,CAAC,CAAC,CAACJ,MAAM;EAC7D;EAEAK,gBAAgBA,CAACC,IAAY;IAC3B,OAAO,IAAI,CAACpB,IAAI,CAACgB,MAAM,CAAEC,IAAI,IAAKA,IAAI,CAACG,IAAI,KAAKA,IAAI,CAAC;EACvD;EAEAC,OAAOA,CAACD,IAAY;IAClB,IAAI,CAACpB,IAAI,CAACsB,OAAO,CAAEL,IAAI,IAAI;MACzB,IAAIA,IAAI,CAACG,IAAI,KAAKA,IAAI,EAAE;QACtB,IAAIH,IAAI,CAACC,MAAM,KAAK,CAAC,EAAE;UACrB,IAAI,CAACK,eAAe,CAACN,IAAI,CAACO,EAAE,CAAC;;QAE/BP,IAAI,CAACC,MAAM,GAAG,CAAC;;IAEnB,CAAC,CAAC;EACJ;EAEA;EACAK,eAAeA,CAACE,SAAiB;IAC/B7B,QAAQ,CAAC,CAAC6B,SAAS,CAAC,CAAC,CAACjB,IAAI,CAAEC,IAAI,IAAI;MAClC,IAAI,CAACA,IAAI,EAAE;IACb,CAAC,CAAC;EACJ;;AAGF,OAAO,MAAMiB,WAAW,GAAG7B,QAAQ,CAAC,IAAIC,WAAW,EAAE,CAAC;AACtD4B,WAAW,CAACzB,WAAW,EAAE"}]}