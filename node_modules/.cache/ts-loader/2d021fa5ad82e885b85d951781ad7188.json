{"remainingRequest":"/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/babel-loader/lib/index.js!/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/ts-loader/index.js??ref--15-2!/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/eslint-loader/index.js??ref--14-0!/Users/nuomi/Desktop/项目/concept/web3-concept/src/dataCenter/wallet.ts","dependencies":[{"path":"/Users/nuomi/Desktop/项目/concept/web3-concept/src/dataCenter/wallet.ts","mtime":1718763992997},{"path":"/Users/nuomi/Desktop/项目/concept/web3-concept/babel.config.js","mtime":1716171552917},{"path":"/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/cache-loader/dist/cjs.js","mtime":1716171608994},{"path":"/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/babel-loader/lib/index.js","mtime":1716171609486},{"path":"/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/ts-loader/index.js","mtime":1716171609531},{"path":"/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/eslint-loader/index.js","mtime":1716171609105}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgdGlwIH0gZnJvbSAnQC9jb21wb25lbnRzL3dhcm4vd2Fybic7CmltcG9ydCB7IGxhbmcgfSBmcm9tICdAL2xhbmcnOwppbXBvcnQgY29ubiwgeyBDb25uTW9kYWwgfSBmcm9tICdAL21hbmFnZXIvY29ubic7CmltcG9ydCBldmVudEJ1cywgeyBFdmVudHMgfSBmcm9tICdAL21hbmFnZXIvZXZlbnRCdXMnOwppbXBvcnQgeyBxdWVyeVJlY2hhcmdlIH0gZnJvbSAnQC91dGlscyc7CmltcG9ydCB7IHJlYWN0aXZlIH0gZnJvbSAndnVlJzsKaW1wb3J0IGRhdGFDZW50ZXIgZnJvbSAnLic7CmNsYXNzIFdhbGxldCB7CiAgY29uc3RydWN0b3IoKSB7CiAgICAvLyDmlrDlop7mmL7npLpDYWxsYmFja1RpcOeahOeKtuaAgQogICAgdGhpcy5zaG93Q2FsbGJhY2tUaXAgPSBmYWxzZTsKICAgIHRoaXMubWFwID0ge307CiAgICB0aGlzLnNlbGVjdElkID0gMDsKICB9CiAgc3RhcnRMaXN0ZW4oKSB7CiAgICBjb25uLmFkZExpc3RlbmVyKENvbm5Nb2RhbC5TMkNfVEhJUkRfUExBWSwgdGhpcyk7CiAgICBjb25uLmFkZExpc3RlbmVyKENvbm5Nb2RhbC5TMkNfTU9ORVlfQ0hBTkdFLCB0aGlzKTsKICB9CiAgc3RvcExpc3RlbigpIHsKICAgIGNvbm4ucmVtb3ZlTGlzdGVuZXIoQ29ubk1vZGFsLlMyQ19USElSRF9QTEFZLCB0aGlzKTsKICAgIGNvbm4ucmVtb3ZlTGlzdGVuZXIoQ29ubk1vZGFsLlMyQ19NT05FWV9DSEFOR0UsIHRoaXMpOwogIH0KICBvbkRhdGEoZGF0YSkgewogICAgaWYgKCd2YWx1ZScgaW4gZGF0YSkgewogICAgICB0aGlzLnNldChkYXRhLmN1cnJlbmN5SWQsIGRhdGEudmFsdWUpOwogICAgICAvLyB0b2Rv57uP6aqM5Y+Y5pu0CiAgICAgIGRhdGFDZW50ZXIudXNlci5hZGRFeHBlcmllbmNlKGRhdGEuZXhwKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY2hhbmdlKGRhdGEuY3VycmVuY3lJZCwgZGF0YS5jaGFuZ2UpOwogICAgICBxdWVyeVJlY2hhcmdlKCk7CiAgICAgIHRpcC5zdWNjZXNzKGxhbmcudi5waXhfc3VyKTsKICAgICAgdGhpcy5zaG93Q2FsbGJhY2tUaXAgPSB0cnVlOwogICAgfQogIH0KICB1cGRhdGUoYmFsYW5jZSkgewogICAgaWYgKCFiYWxhbmNlKSByZXR1cm47CiAgICBiYWxhbmNlLmZvckVhY2goZWxlbWVudCA9PiB7CiAgICAgIHRoaXMubWFwW2VsZW1lbnQuY3VycmVuY3lJZF0gPSBlbGVtZW50OwogICAgfSk7CiAgICBpZiAodGhpcy5zZWxlY3RJZCkgewogICAgICB0aGlzLnNlbGVjdEN1cnJlbmN5KHRoaXMuc2VsZWN0SWQpOwogICAgfQogIH0KICAvKirlop7liqDph5Hpop0gKi8KICBjaGFuZ2UoY3VycmVuY3lJZCwgdmFsdWUpIHsKICAgIGlmICh2YWx1ZSA9PT0gMCkgewogICAgICAvLyB0b2RvIOW8guW4uAogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXRoaXMubWFwW2N1cnJlbmN5SWRdKSB7CiAgICAgIHRoaXMubWFwW2N1cnJlbmN5SWRdID0gewogICAgICAgIGN1cnJlbmN5SWQsCiAgICAgICAgdmFsdWU6IDAKICAgICAgfTsKICAgICAgaWYgKGN1cnJlbmN5SWQgPT09IHRoaXMuc2VsZWN0SWQpIHsKICAgICAgICB0aGlzLnNlbGVjdGVkID0gdGhpcy5tYXBbY3VycmVuY3lJZF07CiAgICAgIH0KICAgIH0KICAgIHRoaXMubWFwW2N1cnJlbmN5SWRdLnZhbHVlICs9IHZhbHVlOwogICAgdGhpcy5kaXNwYXRjaENoYW5nZShjdXJyZW5jeUlkLCB2YWx1ZSk7CiAgfQogIHNldChjdXJyZW5jeUlkLCB2YWx1ZSkgewogICAgaWYgKCF0aGlzLm1hcFtjdXJyZW5jeUlkXSkgewogICAgICB0aGlzLm1hcFtjdXJyZW5jeUlkXSA9IHsKICAgICAgICBjdXJyZW5jeUlkLAogICAgICAgIHZhbHVlOiAwCiAgICAgIH07CiAgICB9CiAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMubWFwW2N1cnJlbmN5SWRdLnZhbHVlOwogICAgaWYgKG9sZFZhbHVlID09PSB2YWx1ZSkgcmV0dXJuOwogICAgdGhpcy5tYXBbY3VycmVuY3lJZF0udmFsdWUgPSB2YWx1ZTsKICAgIHRoaXMuZGlzcGF0Y2hDaGFuZ2UoY3VycmVuY3lJZCwgdmFsdWUgLSBvbGRWYWx1ZSk7CiAgfQogIHNlbGVjdEN1cnJlbmN5KGN1cnJlbmNJZCkgewogICAgdGhpcy5zZWxlY3RJZCA9IGN1cnJlbmNJZDsKICAgIHRoaXMuc2VsZWN0ZWQgPSB0aGlzLm1hcFtjdXJyZW5jSWRdOwogIH0KICBnZXRTZWxlY3RlZEN1cnJlbmN5KCkgewogICAgcmV0dXJuIGRhdGFDZW50ZXIud2ViQ29uZmlnLmN1cnJlbmN5TWFwW3RoaXMuc2VsZWN0SWRdOwogIH0KICBnZXRCYWxhbmNlKCkgewogICAgdmFyIF90aGlzJHNlbGVjdGVkOwogICAgcmV0dXJuICgoX3RoaXMkc2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGVkKSA9PT0gbnVsbCB8fCBfdGhpcyRzZWxlY3RlZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkc2VsZWN0ZWQudmFsdWUpIHx8IDA7CiAgfQogIGRpc3BhdGNoQ2hhbmdlKGN1cnJlbmNJZCwgdmFsdWUpIHsKICAgIGNvbnN0IGN1cnJlbmN5ID0gZGF0YUNlbnRlci53ZWJDb25maWcuY3VycmVuY3lNYXBbY3VycmVuY0lkXTsKICAgIGlmIChjdXJyZW5jeSkgewogICAgICBldmVudEJ1cy5lbWl0KEV2ZW50cy5NT05FWV9DSEFOR0UsIHsKICAgICAgICBjdXJyZW5jeSwKICAgICAgICB2YWx1ZQogICAgICB9KTsKICAgIH0KICB9CiAgcGl4Q3BmKGV2ZW50KSB7CiAgICBjb25zdCBpbnB1dEVsZW1lbnQgPSBldmVudC50YXJnZXQ7CiAgICBsZXQgaW5wdXRWYWx1ZSA9IGlucHV0RWxlbWVudC52YWx1ZS5yZXBsYWNlKC9bXlxkXS9nLCAnJyk7CiAgICBpZiAoaW5wdXRWYWx1ZS5sZW5ndGggPiAzICYmIGlucHV0VmFsdWVbM10gIT09ICcuJykgewogICAgICBpbnB1dFZhbHVlID0gaW5wdXRWYWx1ZS5zbGljZSgwLCAzKSArICcuJyArIGlucHV0VmFsdWUuc2xpY2UoMyk7CiAgICB9CiAgICBpZiAoaW5wdXRWYWx1ZS5sZW5ndGggPiA3ICYmIGlucHV0VmFsdWVbN10gIT09ICcuJykgewogICAgICBpbnB1dFZhbHVlID0gaW5wdXRWYWx1ZS5zbGljZSgwLCA3KSArICcuJyArIGlucHV0VmFsdWUuc2xpY2UoNyk7CiAgICB9CiAgICBpZiAoaW5wdXRWYWx1ZS5sZW5ndGggPiAxMSAmJiBpbnB1dFZhbHVlWzExXSAhPT0gJy0nKSB7CiAgICAgIGlucHV0VmFsdWUgPSBpbnB1dFZhbHVlLnNsaWNlKDAsIDExKSArICctJyArIGlucHV0VmFsdWUuc2xpY2UoMTEpOwogICAgfQogICAgcmV0dXJuIGlucHV0VmFsdWUuc2xpY2UoMCwgMTQpOwogIH0KfQpleHBvcnQgY29uc3Qgd2FsbGV0ID0gcmVhY3RpdmUobmV3IFdhbGxldCgpKTsKd2FsbGV0LnN0YXJ0TGlzdGVuKCk7"},{"version":3,"names":["tip","lang","conn","ConnModal","eventBus","Events","queryRecharge","reactive","dataCenter","Wallet","constructor","showCallbackTip","map","selectId","startListen","addListener","S2C_THIRD_PLAY","S2C_MONEY_CHANGE","stopListen","removeListener","onData","data","set","currencyId","value","user","addExperience","exp","change","success","v","pix_sur","update","balance","forEach","element","selectCurrency","selected","dispatchChange","oldValue","currencId","getSelectedCurrency","webConfig","currencyMap","getBalance","_this$selected","currency","emit","MONEY_CHANGE","pixCpf","event","inputElement","target","inputValue","replace","length","slice","wallet"],"sources":["/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/eslint-loader/index.js??ref--14-0!/Users/nuomi/Desktop/项目/concept/web3-concept/src/dataCenter/wallet.ts"],"sourcesContent":["import { Currency } from '@/api/protocol';\nimport { tip } from '@/components/warn/warn';\nimport { lang } from '@/lang';\nimport conn, { ConnModal, IConnectionListener } from '@/manager/conn';\nimport eventBus, { Events } from '@/manager/eventBus';\nimport { queryRecharge } from '@/utils';\nimport { Recharge } from '@/views/home/api';\nimport { BabalceRespItem } from '@/views/home/api/user-api/headProtocol';\nimport { reactive } from 'vue';\nimport dataCenter from '.';\nexport type Balance = Record<number, BabalceRespItem>;\nexport interface MoneyChange {\n  currency: Currency;\n  value: number;\n}\n/**玩三方游戏通知的金额和经验变更 */\ninterface ThirdPlayGame {\n  currencyId: number;\n  userId: number;\n  /**当前余额 */\n  value: number;\n  change: number;\n  exp: number;\n}\n/**玩三方游戏通知的金额和经验变更 */\ninterface ThirdPlayGame {\n  currencyId: number;\n  userId: number;\n  change: number;\n}\nclass Wallet implements IConnectionListener<ThirdPlayGame> {\n  // 新增显示CallbackTip的状态\n  showCallbackTip = false;\n  startListen() {\n    conn.addListener(ConnModal.S2C_THIRD_PLAY, this);\n    conn.addListener(ConnModal.S2C_MONEY_CHANGE, this);\n  }\n  stopListen() {\n    conn.removeListener(ConnModal.S2C_THIRD_PLAY, this);\n    conn.removeListener(ConnModal.S2C_MONEY_CHANGE, this);\n  }\n  onData(data: ThirdPlayGame | Recharge) {\n    if ('value' in data) {\n      this.set(data.currencyId, data.value);\n      // todo经验变更\n      dataCenter.user.addExperience(data.exp);\n    } else {\n      this.change(data.currencyId, data.change);\n\n      queryRecharge();\n      tip.success(lang.v.pix_sur);\n      this.showCallbackTip = true;\n    }\n  }\n\n  map: Record<number, BabalceRespItem> = {};\n  selected?: BabalceRespItem;\n  selectId = 0;\n  update(balance?: BabalceRespItem[]) {\n    if (!balance) return;\n    balance.forEach((element) => {\n      this.map[element.currencyId] = element;\n    });\n    if (this.selectId) {\n      this.selectCurrency(this.selectId);\n    }\n  }\n  /**增加金额 */\n  change(currencyId: number, value: number) {\n    if (value === 0) {\n      // todo 异常\n      return;\n    }\n    if (!this.map[currencyId]) {\n      this.map[currencyId] = {\n        currencyId,\n        value: 0,\n      };\n      if (currencyId === this.selectId) {\n        this.selected = this.map[currencyId];\n      }\n    }\n    this.map[currencyId].value += value;\n    this.dispatchChange(currencyId, value);\n  }\n  set(currencyId: number, value: number) {\n    if (!this.map[currencyId]) {\n      this.map[currencyId] = {\n        currencyId,\n        value: 0,\n      };\n    }\n    const oldValue = this.map[currencyId].value;\n    if (oldValue === value) return;\n    this.map[currencyId].value = value;\n    this.dispatchChange(currencyId, value - oldValue);\n  }\n  selectCurrency(currencId: number) {\n    this.selectId = currencId;\n    this.selected = this.map[currencId];\n  }\n  getSelectedCurrency() {\n    return dataCenter.webConfig.currencyMap[this.selectId];\n  }\n  getBalance() {\n    return this.selected?.value || 0;\n  }\n  dispatchChange(currencId: number, value: number) {\n    const currency = dataCenter.webConfig.currencyMap[currencId];\n    if (currency) {\n      eventBus.emit(Events.MONEY_CHANGE, { currency, value });\n    }\n  }\n  pixCpf(event: Event) {\n    const inputElement = event.target as HTMLInputElement;\n    let inputValue = inputElement.value.replace(/[^\\d]/g, '');\n    if (inputValue.length > 3 && inputValue[3] !== '.') {\n      inputValue = inputValue.slice(0, 3) + '.' + inputValue.slice(3);\n    }\n\n    if (inputValue.length > 7 && inputValue[7] !== '.') {\n      inputValue = inputValue.slice(0, 7) + '.' + inputValue.slice(7);\n    }\n\n    if (inputValue.length > 11 && inputValue[11] !== '-') {\n      inputValue = inputValue.slice(0, 11) + '-' + inputValue.slice(11);\n    }\n    return inputValue.slice(0, 14);\n  }\n}\n\nexport const wallet = reactive(new Wallet());\n\nwallet.startListen();\n"],"mappings":"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"}]}