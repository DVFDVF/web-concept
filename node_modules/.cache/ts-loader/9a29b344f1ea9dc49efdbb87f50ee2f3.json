{"remainingRequest":"/Users/nuomi/Documents/GitHub/web-concept/node_modules/babel-loader/lib/index.js!/Users/nuomi/Documents/GitHub/web-concept/node_modules/ts-loader/index.js??ref--15-2!/Users/nuomi/Documents/GitHub/web-concept/node_modules/eslint-loader/index.js??ref--14-0!/Users/nuomi/Documents/GitHub/web-concept/src/api/index.ts","dependencies":[{"path":"/Users/nuomi/Documents/GitHub/web-concept/src/api/index.ts","mtime":1719743881007},{"path":"/Users/nuomi/Documents/GitHub/web-concept/babel.config.js","mtime":1716171552917},{"path":"/Users/nuomi/Documents/GitHub/web-concept/node_modules/cache-loader/dist/cjs.js","mtime":1716171608994},{"path":"/Users/nuomi/Documents/GitHub/web-concept/node_modules/babel-loader/lib/index.js","mtime":1716171609486},{"path":"/Users/nuomi/Documents/GitHub/web-concept/node_modules/ts-loader/index.js","mtime":1716171609531},{"path":"/Users/nuomi/Documents/GitHub/web-concept/node_modules/eslint-loader/index.js","mtime":1716171609105}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwppbXBvcnQgeyBBcGlDb2RlIH0gZnJvbSAnQC9tYW5hZ2VyL2NvbnN0JzsKaW1wb3J0IHsgZm9yY2VSZWxvYWQgfSBmcm9tICdAL21hbmFnZXIvdmlldyc7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCBxcyBmcm9tICdxcyc7CmltcG9ydCB7IHRva2VuQ29udHJvbGxlciB9IGZyb20gJy4uL21hbmFnZXIvdG9rZW4nOwppbXBvcnQgeyBGUkVTSF9UT0tFTl9VUkwgfSBmcm9tICcuL3Byb3RvY29sJzsKaW1wb3J0IHsgdGlwIH0gZnJvbSAnQC9jb21wb25lbnRzL3dhcm4vd2Fybic7CmltcG9ydCBkYXRhQ2VudGVyIGZyb20gJ0AvZGF0YUNlbnRlcic7CmNvbnN0IHNlcnZpY2UgPSBheGlvcy5jcmVhdGUoewogIGJhc2VVUkw6IHByb2Nlc3MuZW52LlZVRV9BUFBfU0VSVkVSLAogIHRpbWVvdXQ6IDEwICogMTAwMCwKICBoZWFkZXJzOiB7CiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOCcKICB9Cn0pOwpzZXJ2aWNlLmludGVyY2VwdG9ycy5yZXF1ZXN0LnVzZShjb25maWcgPT4gewogIC8vIOi/memHjOWPr+S7peiuvue9rnRva2VuOiBjb25maWchLmhlYWRlcnMhLkF1dGhvcml6YXRpb24gPSB0b2tlbgogIGNvbmZpZy5oZWFkZXJzLmF1dGggPSB0b2tlbkNvbnRyb2xsZXIudG9rZW47CiAgY29uZmlnLmhlYWRlcnMuc2lnbiA9IGRhdGFDZW50ZXIuc2lnblswXTsKICByZXR1cm4gY29uZmlnOwp9KTsKc2VydmljZS5pbnRlcmNlcHRvcnMucmVzcG9uc2UudXNlKHJlc3BvbnNlID0+IHsKICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZGF0YTsKICAvLyDojrflj5blvZPliY3or7fmsYLnmoTmjqXlj6PlnLDlnYAKICBpZiAoZGF0YS5jb2RlID09PSAyMDApIHsKICAgIHJldHVybiBkYXRhLmRhdGE7CiAgfQogIGlmIChkYXRhLmNvZGUgPT09IEFwaUNvZGUuVU5fQVVUSCkgewogICAgLy/pgIDlh7rnmbvlvZUKICAgIHJldHVybiBmcmVzaFRva2VuKCkudGhlbigoKSA9PiBzZXJ2aWNlKHJlc3BvbnNlLmNvbmZpZykpOwogIH0gZWxzZSBpZiAoZGF0YS5jb2RlID09PSBBcGlDb2RlLkZSRVNIX1RPS0VOX0VYUElSRSB8fCBkYXRhLmNvZGUgPT09IEFwaUNvZGUuRlJFU0hfVE9LRU5fVU5LTk9XTikgewogICAgLy8g6ZW/dG9rZW7lt7LlpLHmlYgKICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgn55m75b2V5bey6L+H5pyfJyk7CiAgfSBlbHNlIGlmIChkYXRhLmNvZGUgPT09IEFwaUNvZGUuVE9LRU5fRVhQSVJFX1VQREFUQSkgewogICAgLy/lpoLmnpzplb90b2tlbuWkseaViOWIt+aWsHRva2VuCiAgICB0b2tlbkNvbnRyb2xsZXIudXBkYXRlRnJlc2hUb2tlbihkYXRhLmRhdGEpOwogICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdyZXN0YXJ0Jyk7CiAgfSBlbHNlIHsKICAgIGlmIChkYXRhLmNvZGUgPiAxMDAwMCkgewogICAgICBpZiAoZGF0YS5jb2RlID09IDIwMDE2KSB7CiAgICAgICAgZm9yY2VSZWxvYWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDmma7pgJrplJnor6/vvIzorablkYrmj5DphpIKICAgICAgICB0aXAuZXJyb3IoZGF0YS5tc2cpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyDkuJrliqHkuKXph43plJnor6/vvIzlvLnnqpfmj5DphpIKICAgICAgdGlwLmVycm9yKGRhdGEubXNnKTsKICAgIH0KICAgIHJldHVybiBQcm9taXNlLnJlamVjdChkYXRhLm1zZyk7CiAgfQp9LCBlcnIgPT4gewogIGlmIChlcnIuY29uZmlnLmhlYWRlcnMuYXV0bykgewogICAgdGlwLmVycm9yKGVyci5tZXNzYWdlIHx8ICfnvZHnu5zlvILluLjvvIzor7fnqI3lkI7ph43or5UnKTsKICB9CiAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVyci5yZXNwb25zZSk7Cn0pOwpsZXQgZnJlc2hQcm9taXNlID0gdW5kZWZpbmVkOwpleHBvcnQgZnVuY3Rpb24gZnJlc2hUb2tlbigpIHsKICBpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHsKICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ+e9kee7nOW8guW4uCcpKTsKICB9CiAgY29uc3QgZnJlc2hUb2tlbiA9IHRva2VuQ29udHJvbGxlci5mcmVzaFRva2VuOwogIGlmIChmcmVzaFRva2VuKSB7CiAgICBmcmVzaFByb21pc2UgPSBwb3N0KEZSRVNIX1RPS0VOX1VSTCwgewogICAgICBmcmVzaFRva2VuCiAgICB9KS50aGVuKHJlc3AgPT4gdG9rZW5Db250cm9sbGVyLnVwZGF0ZVRva2VuKHJlc3ApKS5jYXRjaChlcnIgPT4gewogICAgICBpZiAoZXJyID09ICfnmbvlvZXlt7Lov4fmnJ8nKSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcign55m75b2V5bey6L+H5pyfJykpOwogICAgICB9CiAgICB9KS5maW5hbGx5KCgpID0+IHsKICAgICAgZnJlc2hQcm9taXNlID0gdW5kZWZpbmVkOwogICAgfSk7CiAgICByZXR1cm4gZnJlc2hQcm9taXNlOwogIH0gZWxzZSB7CiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCfnmbvlvZXlt7Lov4fmnJ8nKSk7CiAgfQp9CmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXQodXJsLCBwYXJhbXMsIGhlYWRlcikgewogIGNvbnN0IHF1ZXJ5ID0gcGFyYW1zID8gcXMuc3RyaW5naWZ5KHBhcmFtcykgOiB1bmRlZmluZWQ7CiAgY29uc3QgY29ubmVjdFN5bWJvbCA9IHVybC5pbmNsdWRlcygnPycpID8gJyYnIDogJz8nOwogIHJldHVybiBhd2FpdCBzZXJ2aWNlLmdldChxdWVyeSA/IGAke3VybH0ke2Nvbm5lY3RTeW1ib2x9JHtxdWVyeX1gIDogdXJsLCBoZWFkZXIpOwp9CmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwb3N0KHVybCwgYm9keSwgaGVhZGVyKSB7CiAgcmV0dXJuIGF3YWl0IHNlcnZpY2UucG9zdCh1cmwsIGJvZHksIGhlYWRlcik7Cn0KZXhwb3J0IGRlZmF1bHQgc2VydmljZTs="},{"version":3,"names":["ApiCode","forceReload","axios","qs","tokenController","FRESH_TOKEN_URL","tip","dataCenter","service","create","baseURL","process","env","VUE_APP_SERVER","timeout","headers","interceptors","request","use","config","auth","token","sign","response","data","code","UN_AUTH","freshToken","then","FRESH_TOKEN_EXPIRE","FRESH_TOKEN_UNKNOWN","Promise","reject","TOKEN_EXPIRE_UPDATA","updateFreshToken","window","location","reload","error","msg","err","auto","message","freshPromise","undefined","navigator","onLine","Error","post","resp","updateToken","catch","finally","get","url","params","header","query","stringify","connectSymbol","includes","body"],"sources":["/Users/nuomi/Documents/GitHub/web-concept/node_modules/eslint-loader/index.js??ref--14-0!/Users/nuomi/Documents/GitHub/web-concept/src/api/index.ts"],"sourcesContent":["import { ApiCode } from '@/manager/const';\nimport { forceReload } from '@/manager/view';\nimport type { AxiosInstance, AxiosResponse } from 'axios';\nimport axios from 'axios';\nimport qs from 'qs';\nimport { tokenController } from '../manager/token';\nimport { FRESH_TOKEN_URL } from './protocol';\nimport { tip } from '@/components/warn/warn';\nimport dataCenter from '@/dataCenter';\n\nconst service: AxiosInstance = axios.create({\n  baseURL: process.env.VUE_APP_SERVER,\n  timeout: 10 * 1000, // 请求超时时间\n  headers: { 'Content-Type': 'application/json;charset=UTF-8' },\n});\nservice.interceptors.request.use((config) => {\n  // 这里可以设置token: config!.headers!.Authorization = token\n  config.headers.auth = tokenController.token;\n  config.headers.sign = dataCenter.sign[0];\n  return config;\n});\nservice.interceptors.response.use(\n  (response: AxiosResponse) => {\n    const data = response.data;\n\n    // 获取当前请求的接口地址\n    if (data.code === 200) {\n      return data.data;\n    }\n    if (data.code === ApiCode.UN_AUTH) {\n      //退出登录\n      return freshToken().then(() => service(response.config));\n    } else if (\n      data.code === ApiCode.FRESH_TOKEN_EXPIRE ||\n      data.code === ApiCode.FRESH_TOKEN_UNKNOWN\n    ) {\n      // 长token已失效\n      return Promise.reject('登录已过期');\n    } else if (data.code === ApiCode.TOKEN_EXPIRE_UPDATA) {\n      //如果长token失效刷新token\n      tokenController.updateFreshToken(data.data);\n      window.location.reload();\n      return Promise.reject('restart');\n    } else {\n      if (data.code > 10000) {\n        if (data.code == 20016) {\n          forceReload();\n        } else {\n          // 普通错误，警告提醒\n          tip.error(data.msg);\n        }\n      } else {\n        // 业务严重错误，弹窗提醒\n        tip.error(data.msg);\n      }\n      return Promise.reject(data.msg);\n    }\n  },\n  (err) => {\n    if (err.config.headers.auto) {\n      tip.error(err.message || '网络异常，请稍后重试');\n    }\n    return Promise.reject(err.response);\n  },\n);\n\nlet freshPromise: Promise<void> | undefined = undefined;\n\nexport function freshToken() {\n  if (!navigator.onLine) {\n    return Promise.reject(new Error('网络异常'));\n  }\n  const freshToken = tokenController.freshToken;\n  if (freshToken) {\n    freshPromise = post<string, { freshToken: string }>(FRESH_TOKEN_URL, {\n      freshToken,\n    })\n      .then((resp) => tokenController.updateToken(resp))\n      .catch((err: string) => {\n        if (err == '登录已过期') {\n          return Promise.reject(new Error('登录已过期'));\n        }\n      })\n      .finally(() => {\n        freshPromise = undefined;\n      });\n    return freshPromise;\n  } else {\n    return Promise.reject(new Error('登录已过期'));\n  }\n}\n\nexport async function get<R = any, T = any>(\n  url: string,\n  params?: T,\n  header?: Record<string, any>,\n): Promise<R> {\n  const query = params ? qs.stringify(params) : undefined;\n  const connectSymbol = url.includes('?') ? '&' : '?';\n  return await service.get(\n    query ? `${url}${connectSymbol}${query}` : url,\n    header,\n  );\n}\n\nexport async function post<R = any, T = any>(\n  url: string,\n  body?: T,\n  header?: Record<string, any>,\n): Promise<R> {\n  return await service.post(url, body, header);\n}\n\nexport default service;\n"],"mappings":"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"}]}