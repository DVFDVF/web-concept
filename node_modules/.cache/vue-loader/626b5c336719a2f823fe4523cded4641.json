{"remainingRequest":"/Users/nuomi/Desktop/项目/concept/fury-client/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/Users/nuomi/Desktop/项目/concept/fury-client/src/views/chats/chatsArea/ChatsArea.vue?vue&type=template&id=48aaae03&scoped=true&ts=true","dependencies":[{"path":"/Users/nuomi/Desktop/项目/concept/fury-client/src/views/chats/chatsArea/ChatsArea.vue","mtime":1716171553022},{"path":"/Users/nuomi/Desktop/项目/concept/fury-client/node_modules/cache-loader/dist/cjs.js","mtime":1716171608994},{"path":"/Users/nuomi/Desktop/项目/concept/fury-client/node_modules/babel-loader/lib/index.js","mtime":1716171609486},{"path":"/Users/nuomi/Desktop/项目/concept/fury-client/node_modules/ts-loader/index.js","mtime":1716171609531},{"path":"/Users/nuomi/Desktop/项目/concept/fury-client/node_modules/vue-loader-v16/dist/templateLoader.js","mtime":1716171609809},{"path":"/Users/nuomi/Desktop/项目/concept/fury-client/node_modules/cache-loader/dist/cjs.js","mtime":1716171608994},{"path":"/Users/nuomi/Desktop/项目/concept/fury-client/node_modules/vue-loader-v16/dist/index.js","mtime":1716171609468}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgPGRpdiBjbGFzcz0ibWFpbiI+CiAgICA8ZGl2IGNsYXNzPSJjb250ZW50IiByZWY9InNjcm9sbENvbnRhaW5lciIgQHNjcm9sbD0iaGFuZGxlU2Nyb2xsIj4KICAgICAgPCEtLSA8Q2hhdHNDZW50ZXJJY29uPjwvQ2hhdHNDZW50ZXJJY29uPiAtLT4KICAgICAgPGRpdiBjbGFzcz0iY29sLWNlbnRlciIgdi1zaG93PSJpc0xvZGRpbmciPgogICAgICAgIDxDaGF0c0xvZGRpbmcgc3R5bGU9IndpZHRoOiAyMHB4OyBoZWlnaHQ6IDIwcHgiPjwvQ2hhdHNMb2RkaW5nPgogICAgICA8L2Rpdj4KICAgICAgPENoYXRzQ2VudGVyCiAgICAgICAgdi1mb3I9Iml0ZW0gaW4gbWVzc2FnZUxpc3QiCiAgICAgICAgOmtleT0iaXRlbS5pZCIKICAgICAgICA6bXNnLWl0ZW09Iml0ZW0iCiAgICAgICAgQHJlcGx5Q2xpY2s9InJlcGx5Q2xpY2siCiAgICAgID48L0NoYXRzQ2VudGVyPgogICAgPC9kaXY+CiAgICA8YnV0dG9uCiAgICAgIGNsYXNzPSJzY3JvbGwtaW50ZXJhY3Rpb24tYnV0dG9uIGNlbnRlciB2aXNpYmxlIgogICAgICBAY2xpY2s9InNjcm9sbFRvQnV0dG9tKCkiCiAgICAgIHYtc2hvdz0ic2Nyb2xsQnRuIgogICAgPgogICAgICA8c3ZnCiAgICAgICAgd2lkdGg9IjEwIgogICAgICAgIGhlaWdodD0iNiIKICAgICAgICB2aWV3Qm94PSIwIDAgMTAgNiIKICAgICAgICBmaWxsPSJub25lIgogICAgICAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgICAgPgogICAgICAgIDxwYXRoCiAgICAgICAgICBkPSJNMSAxTDUgNUw5IDEiCiAgICAgICAgICBzdHJva2U9IndoaXRlIgogICAgICAgICAgc3Ryb2tlLXdpZHRoPSIyIgogICAgICAgICAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogICAgICAgICAgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIKICAgICAgICA+PC9wYXRoPgogICAgICA8L3N2Zz4KICAgICAgPCEtLSA8c3BhbiBjbGFzcz0iYW1vdW50IGNlbnRlciB1bnJlYWQtYW1vdW50Ij45PC9zcGFuPiAtLT4KICAgIDwvYnV0dG9uPgogIDwvZGl2Pgo="},{"version":3,"sources":["/Users/nuomi/Desktop/项目/concept/fury-client/src/views/chats/chatsArea/ChatsArea.vue"],"names":[],"mappings":";EACE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACf,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MAC/D,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;MAC3C,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACxC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MAChE,CAAC,CAAC,CAAC,CAAC,CAAC;MACL,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACT,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC1B,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACb,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACf,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACzB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAChB,CAAC,CAAC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACJ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MAC/C,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACxB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACnB;MACE,CAAC,CAAC,CAAC;QACD,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACT,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACT,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC;QACjB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACV,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACnC;QACE,CAAC,CAAC,CAAC,CAAC;UACF,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC;UACf,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;UACb,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;UACf,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;UACrB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACxB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACT,CAAC,CAAC,CAAC,CAAC,CAAC;MACL,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;IAC5D,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACV,CAAC,CAAC,CAAC,CAAC,CAAC","file":"/Users/nuomi/Desktop/项目/concept/fury-client/src/views/chats/chatsArea/ChatsArea.vue","sourceRoot":"","sourcesContent":["<template>\n  <div class=\"main\">\n    <div class=\"content\" ref=\"scrollContainer\" @scroll=\"handleScroll\">\n      <!-- <ChatsCenterIcon></ChatsCenterIcon> -->\n      <div class=\"col-center\" v-show=\"isLodding\">\n        <ChatsLodding style=\"width: 20px; height: 20px\"></ChatsLodding>\n      </div>\n      <ChatsCenter\n        v-for=\"item in messageList\"\n        :key=\"item.id\"\n        :msg-item=\"item\"\n        @replyClick=\"replyClick\"\n      ></ChatsCenter>\n    </div>\n    <button\n      class=\"scroll-interaction-button center visible\"\n      @click=\"scrollToButtom()\"\n      v-show=\"scrollBtn\"\n    >\n      <svg\n        width=\"10\"\n        height=\"6\"\n        viewBox=\"0 0 10 6\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          d=\"M1 1L5 5L9 1\"\n          stroke=\"white\"\n          stroke-width=\"2\"\n          stroke-linecap=\"round\"\n          stroke-linejoin=\"round\"\n        ></path>\n      </svg>\n      <!-- <span class=\"amount center unread-amount\">9</span> -->\n    </button>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { UserBriefRespItem } from '@/api/protocol';\nimport dataCenter from '@/dataCenter';\nimport { ChatData } from '@/dataCenter/chatRoom';\nimport { defineComponent, nextTick, ref, watch } from 'vue';\nimport ChatsLodding from '../ChatsLodding.vue';\nimport ChatsCenter from './ChatsCenter.vue';\nexport default defineComponent({\n  data() {\n    return {\n      isLodding: false,\n      scrollBtn: false,\n      isEmpty: false,\n    };\n  },\n  methods: {\n    scrollToButtom() {\n      // 使用$refs来获取元素引用\n      const scrollContainer = this.$refs.scrollContainer as HTMLElement;\n      if (scrollContainer) {\n        // 滚动到底部\n        this.$nextTick(() => {\n          scrollContainer.scrollTop = scrollContainer.scrollHeight;\n        });\n      }\n    },\n    handleScroll() {\n      // 如何加载正在进行，不再请求刷新\n      if (this.isLodding || this.isEmpty) return;\n      const scrollContainer = this.$refs.scrollContainer as HTMLElement;\n      if (!scrollContainer) return;\n      const scrollHeight = scrollContainer.scrollHeight;\n      //如果超过一个页面区域，显示滚动按钮\n      if (\n        scrollContainer.scrollTop + scrollContainer.clientHeight * 2 <\n        scrollHeight\n      ) {\n        this.scrollBtn = false;\n      } else {\n        this.scrollBtn = false;\n      }\n      if (scrollContainer.scrollTop <= 0) {\n        if (this.messageList) {\n          //如果大于两百条就不要请求数据了\n          if (this.messageList.length >= 200) {\n            this.isLodding = false;\n            return;\n          }\n        }\n        // 检查滚动位置是否在页面顶部\n        this.isLodding = true;\n        dataCenter.chatRoom\n          .pullHistory()\n          .then(() => {\n            this.$nextTick(() => {\n              const nowScrollPosition = scrollContainer.scrollHeight;\n              scrollContainer.scrollTop = nowScrollPosition - scrollHeight;\n            });\n          })\n          .finally(() => {\n            this.isLodding = false;\n            if (scrollContainer.scrollTop <= 23) {\n              this.isEmpty = true;\n            }\n          });\n      }\n    },\n    replyClick(msgItem: ChatData, userBrief: UserBriefRespItem) {\n      this.$emit('replyClick', msgItem, userBrief);\n    },\n  },\n  setup() {\n    const scrollContainer = ref<HTMLElement | null>(null);\n    watch(\n      () => dataCenter.chatRoom.list.length,\n      () => {\n        nextTick(() => {\n          if (scrollContainer.value) {\n            let scroll = scrollContainer.value as HTMLElement;\n            if (!scroll) return;\n            const scrollHeight = scroll.scrollHeight;\n            if (scroll) {\n              //滚动多了，不再滚动\n              if (\n                //超过一页不再自动滚动到底部\n                scroll.scrollTop + scroll.clientHeight * 2 <\n                scrollHeight\n              )\n                return;\n              scroll.scrollTop = scrollHeight;\n            }\n          }\n        });\n      },\n    );\n    return {\n      scrollContainer,\n    };\n  },\n  components: { ChatsCenter, ChatsLodding },\n  props: {\n    messageList: {\n      type: Object as () => ChatData[],\n    },\n  },\n});\n</script>\n\n<style lang=\"less\" scoped>\n.main {\n  flex: 1;\n  position: relative;\n  overflow: hidden;\n}\n.content {\n  flex: 1;\n  height: 100%;\n  overflow-y: auto;\n  padding-bottom: 10px;\n}\n.scroll-interaction-button.visible {\n  opacity: 1;\n  transform: translateY(0);\n  visibility: visible;\n}\n.scroll-interaction-button {\n  background-color: #3c485c;\n  border-radius: 50%;\n  bottom: 16px;\n  height: 40px;\n  min-width: 40px;\n  opacity: 0;\n  padding: 0;\n  position: absolute;\n  right: 14px;\n  transform: translateY(10px);\n  transition: background-color 0.1s ease-in-out, transform 0.1s ease-in-out,\n    opacity 0.1s ease-in-out;\n  visibility: hidden;\n  will-change: background-color, transform, opacity;\n  z-index: 3;\n}\n.scroll-interaction-button .amount {\n  background-color: #1bb83d;\n  border-radius: 50px;\n  color: #fff;\n  font-size: 12px;\n  font-weight: 600;\n  height: 20px;\n  left: 50%;\n  letter-spacing: -0.02em;\n  min-width: 20px;\n  padding-left: 5px;\n  padding-right: 5px;\n  position: absolute;\n  top: 0;\n  transform: translate(-50%, -50%);\n  transition: background-color 0.1s ease-in-out;\n}\n\n.scroll-interaction-button:hover {\n  background-color: #55657e;\n}\n</style>\n"]}]}