{"remainingRequest":"/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/babel-loader/lib/index.js!/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/ts-loader/index.js??ref--15-2!/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/Users/nuomi/Desktop/项目/fury-client/fury-client/src/views/chats/chatsArea/ChatsArea.vue?vue&type=script&lang=ts","dependencies":[{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/src/views/chats/chatsArea/ChatsArea.vue","mtime":1716171553022},{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/babel.config.js","mtime":1716171552917},{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/cache-loader/dist/cjs.js","mtime":1716171608994},{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/babel-loader/lib/index.js","mtime":1716171609486},{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/ts-loader/index.js","mtime":1716171609531},{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/cache-loader/dist/cjs.js","mtime":1716171608994},{"path":"/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/vue-loader-v16/dist/index.js","mtime":1716171609468}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGRhdGFDZW50ZXIgZnJvbSAnQC9kYXRhQ2VudGVyJzsKaW1wb3J0IHsgZGVmaW5lQ29tcG9uZW50LCBuZXh0VGljaywgcmVmLCB3YXRjaCB9IGZyb20gJ3Z1ZSc7CmltcG9ydCBDaGF0c0xvZGRpbmcgZnJvbSAnLi4vQ2hhdHNMb2RkaW5nLnZ1ZSc7CmltcG9ydCBDaGF0c0NlbnRlciBmcm9tICcuL0NoYXRzQ2VudGVyLnZ1ZSc7CmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGlzTG9kZGluZzogZmFsc2UsCiAgICAgIHNjcm9sbEJ0bjogZmFsc2UsCiAgICAgIGlzRW1wdHk6IGZhbHNlCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgc2Nyb2xsVG9CdXR0b20oKSB7CiAgICAgIC8vIOS9v+eUqCRyZWZz5p2l6I635Y+W5YWD57Sg5byV55SoCiAgICAgIGNvbnN0IHNjcm9sbENvbnRhaW5lciA9IHRoaXMuJHJlZnMuc2Nyb2xsQ29udGFpbmVyOwogICAgICBpZiAoc2Nyb2xsQ29udGFpbmVyKSB7CiAgICAgICAgLy8g5rua5Yqo5Yiw5bqV6YOoCiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgc2Nyb2xsQ29udGFpbmVyLnNjcm9sbFRvcCA9IHNjcm9sbENvbnRhaW5lci5zY3JvbGxIZWlnaHQ7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVTY3JvbGwoKSB7CiAgICAgIC8vIOWmguS9leWKoOi9veato+WcqOi/m+ihjO+8jOS4jeWGjeivt+axguWIt+aWsAogICAgICBpZiAodGhpcy5pc0xvZGRpbmcgfHwgdGhpcy5pc0VtcHR5KSByZXR1cm47CiAgICAgIGNvbnN0IHNjcm9sbENvbnRhaW5lciA9IHRoaXMuJHJlZnMuc2Nyb2xsQ29udGFpbmVyOwogICAgICBpZiAoIXNjcm9sbENvbnRhaW5lcikgcmV0dXJuOwogICAgICBjb25zdCBzY3JvbGxIZWlnaHQgPSBzY3JvbGxDb250YWluZXIuc2Nyb2xsSGVpZ2h0OwogICAgICAvL+WmguaenOi2hei/h+S4gOS4qumhtemdouWMuuWfn++8jOaYvuekuua7muWKqOaMiemSrgogICAgICBpZiAoc2Nyb2xsQ29udGFpbmVyLnNjcm9sbFRvcCArIHNjcm9sbENvbnRhaW5lci5jbGllbnRIZWlnaHQgKiAyIDwgc2Nyb2xsSGVpZ2h0KSB7CiAgICAgICAgdGhpcy5zY3JvbGxCdG4gPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNjcm9sbEJ0biA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzY3JvbGxDb250YWluZXIuc2Nyb2xsVG9wIDw9IDApIHsKICAgICAgICBpZiAodGhpcy5tZXNzYWdlTGlzdCkgewogICAgICAgICAgLy/lpoLmnpzlpKfkuo7kuKTnmb7mnaHlsLHkuI3opoHor7fmsYLmlbDmja7kuoYKICAgICAgICAgIGlmICh0aGlzLm1lc3NhZ2VMaXN0Lmxlbmd0aCA+PSAyMDApIHsKICAgICAgICAgICAgdGhpcy5pc0xvZGRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyDmo4Dmn6Xmu5rliqjkvY3nva7mmK/lkKblnKjpobXpnaLpobbpg6gKICAgICAgICB0aGlzLmlzTG9kZGluZyA9IHRydWU7CiAgICAgICAgZGF0YUNlbnRlci5jaGF0Um9vbS5wdWxsSGlzdG9yeSgpLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgICBjb25zdCBub3dTY3JvbGxQb3NpdGlvbiA9IHNjcm9sbENvbnRhaW5lci5zY3JvbGxIZWlnaHQ7CiAgICAgICAgICAgIHNjcm9sbENvbnRhaW5lci5zY3JvbGxUb3AgPSBub3dTY3JvbGxQb3NpdGlvbiAtIHNjcm9sbEhlaWdodDsKICAgICAgICAgIH0pOwogICAgICAgIH0pLmZpbmFsbHkoKCkgPT4gewogICAgICAgICAgdGhpcy5pc0xvZGRpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmIChzY3JvbGxDb250YWluZXIuc2Nyb2xsVG9wIDw9IDIzKSB7CiAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICByZXBseUNsaWNrKG1zZ0l0ZW0sIHVzZXJCcmllZikgewogICAgICB0aGlzLiRlbWl0KCdyZXBseUNsaWNrJywgbXNnSXRlbSwgdXNlckJyaWVmKTsKICAgIH0KICB9LAogIHNldHVwKCkgewogICAgY29uc3Qgc2Nyb2xsQ29udGFpbmVyID0gcmVmKG51bGwpOwogICAgd2F0Y2goKCkgPT4gZGF0YUNlbnRlci5jaGF0Um9vbS5saXN0Lmxlbmd0aCwgKCkgPT4gewogICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgaWYgKHNjcm9sbENvbnRhaW5lci52YWx1ZSkgewogICAgICAgICAgbGV0IHNjcm9sbCA9IHNjcm9sbENvbnRhaW5lci52YWx1ZTsKICAgICAgICAgIGlmICghc2Nyb2xsKSByZXR1cm47CiAgICAgICAgICBjb25zdCBzY3JvbGxIZWlnaHQgPSBzY3JvbGwuc2Nyb2xsSGVpZ2h0OwogICAgICAgICAgaWYgKHNjcm9sbCkgewogICAgICAgICAgICAvL+a7muWKqOWkmuS6hu+8jOS4jeWGjea7muWKqAogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgIC8v6LaF6L+H5LiA6aG15LiN5YaN6Ieq5Yqo5rua5Yqo5Yiw5bqV6YOoCiAgICAgICAgICAgIHNjcm9sbC5zY3JvbGxUb3AgKyBzY3JvbGwuY2xpZW50SGVpZ2h0ICogMiA8IHNjcm9sbEhlaWdodCkgcmV0dXJuOwogICAgICAgICAgICBzY3JvbGwuc2Nyb2xsVG9wID0gc2Nyb2xsSGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiB7CiAgICAgIHNjcm9sbENvbnRhaW5lcgogICAgfTsKICB9LAogIGNvbXBvbmVudHM6IHsKICAgIENoYXRzQ2VudGVyLAogICAgQ2hhdHNMb2RkaW5nCiAgfSwKICBwcm9wczogewogICAgbWVzc2FnZUxpc3Q6IHsKICAgICAgdHlwZTogT2JqZWN0CiAgICB9CiAgfQp9KTs="},{"version":3,"names":["dataCenter","defineComponent","nextTick","ref","watch","ChatsLodding","ChatsCenter","data","isLodding","scrollBtn","isEmpty","methods","scrollToButtom","scrollContainer","$refs","$nextTick","scrollTop","scrollHeight","handleScroll","clientHeight","messageList","length","chatRoom","pullHistory","then","nowScrollPosition","finally","replyClick","msgItem","userBrief","$emit","setup","list","value","scroll","components","props","type","Object"],"sources":["/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/nuomi/Desktop/项目/fury-client/fury-client/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/Users/nuomi/Desktop/项目/fury-client/fury-client/src/views/chats/chatsArea/ChatsArea.vue?vue&type=script&lang=ts"],"sourcesContent":["\nimport { UserBriefRespItem } from '@/api/protocol';\nimport dataCenter from '@/dataCenter';\nimport { ChatData } from '@/dataCenter/chatRoom';\nimport { defineComponent, nextTick, ref, watch } from 'vue';\nimport ChatsLodding from '../ChatsLodding.vue';\nimport ChatsCenter from './ChatsCenter.vue';\nexport default defineComponent({\n  data() {\n    return {\n      isLodding: false,\n      scrollBtn: false,\n      isEmpty: false,\n    };\n  },\n  methods: {\n    scrollToButtom() {\n      // 使用$refs来获取元素引用\n      const scrollContainer = this.$refs.scrollContainer as HTMLElement;\n      if (scrollContainer) {\n        // 滚动到底部\n        this.$nextTick(() => {\n          scrollContainer.scrollTop = scrollContainer.scrollHeight;\n        });\n      }\n    },\n    handleScroll() {\n      // 如何加载正在进行，不再请求刷新\n      if (this.isLodding || this.isEmpty) return;\n      const scrollContainer = this.$refs.scrollContainer as HTMLElement;\n      if (!scrollContainer) return;\n      const scrollHeight = scrollContainer.scrollHeight;\n      //如果超过一个页面区域，显示滚动按钮\n      if (\n        scrollContainer.scrollTop + scrollContainer.clientHeight * 2 <\n        scrollHeight\n      ) {\n        this.scrollBtn = false;\n      } else {\n        this.scrollBtn = false;\n      }\n      if (scrollContainer.scrollTop <= 0) {\n        if (this.messageList) {\n          //如果大于两百条就不要请求数据了\n          if (this.messageList.length >= 200) {\n            this.isLodding = false;\n            return;\n          }\n        }\n        // 检查滚动位置是否在页面顶部\n        this.isLodding = true;\n        dataCenter.chatRoom\n          .pullHistory()\n          .then(() => {\n            this.$nextTick(() => {\n              const nowScrollPosition = scrollContainer.scrollHeight;\n              scrollContainer.scrollTop = nowScrollPosition - scrollHeight;\n            });\n          })\n          .finally(() => {\n            this.isLodding = false;\n            if (scrollContainer.scrollTop <= 23) {\n              this.isEmpty = true;\n            }\n          });\n      }\n    },\n    replyClick(msgItem: ChatData, userBrief: UserBriefRespItem) {\n      this.$emit('replyClick', msgItem, userBrief);\n    },\n  },\n  setup() {\n    const scrollContainer = ref<HTMLElement | null>(null);\n    watch(\n      () => dataCenter.chatRoom.list.length,\n      () => {\n        nextTick(() => {\n          if (scrollContainer.value) {\n            let scroll = scrollContainer.value as HTMLElement;\n            if (!scroll) return;\n            const scrollHeight = scroll.scrollHeight;\n            if (scroll) {\n              //滚动多了，不再滚动\n              if (\n                //超过一页不再自动滚动到底部\n                scroll.scrollTop + scroll.clientHeight * 2 <\n                scrollHeight\n              )\n                return;\n              scroll.scrollTop = scrollHeight;\n            }\n          }\n        });\n      },\n    );\n    return {\n      scrollContainer,\n    };\n  },\n  components: { ChatsCenter, ChatsLodding },\n  props: {\n    messageList: {\n      type: Object as () => ChatData[],\n    },\n  },\n});\n"],"mappings":"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"}]}