{"remainingRequest":"/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/babel-loader/lib/index.js!/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/ts-loader/index.js??ref--15-2!/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/eslint-loader/index.js??ref--14-0!/Users/nuomi/Desktop/项目/concept/web3-concept/src/manager/SoundManager.ts","dependencies":[{"path":"/Users/nuomi/Desktop/项目/concept/web3-concept/src/manager/SoundManager.ts","mtime":1716171553014},{"path":"/Users/nuomi/Desktop/项目/concept/web3-concept/babel.config.js","mtime":1716171552917},{"path":"/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/cache-loader/dist/cjs.js","mtime":1716171608994},{"path":"/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/babel-loader/lib/index.js","mtime":1716171609486},{"path":"/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/ts-loader/index.js","mtime":1716171609531},{"path":"/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/eslint-loader/index.js","mtime":1716171609105}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCBkYXRhQ2VudGVyIGZyb20gJ0AvZGF0YUNlbnRlcic7CmNsYXNzIFNvdW5kTWFuYWdlciB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLm1hcCA9IHt9OwogICAgdGhpcy5fa2VlcEFsaXZlcyA9IFtdOwogICAgLyoq5paw5aKe77ya5a2Y5YKo5omA5pyJIFNvdW5kUGxheWVyIOWvueixoSAqLwogICAgdGhpcy5fYWN0aXZlUGxheWVycyA9IFtdOwogICAgdGhpcy5sb2FkU291bmQgPSB1cmwgPT4gewogICAgICBjb25zdCBsb2FkaW5nUHJvbWlzZSA9IHRoaXMubWFwW3VybF07CiAgICAgIGlmIChsb2FkaW5nUHJvbWlzZSAmJiBsb2FkaW5nUHJvbWlzZS5sb2FkaW5nKSB7CiAgICAgICAgcmV0dXJuIGxvYWRpbmdQcm9taXNlLnByb21pc2U7CiAgICAgIH0KICAgICAgY29uc3QgYXVkaW8gPSBuZXcgQXVkaW8odXJsKTsKICAgICAgY29uc3QgYXVkaW9Db250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpOwogICAgICBjb25zdCBnYWluTm9kZSA9IGF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7CiAgICAgIGdhaW5Ob2RlLmNvbm5lY3QoYXVkaW9Db250ZXh0LmRlc3RpbmF0aW9uKTsKICAgICAgLy8g6K6+572u6Z+z6YePCiAgICAgIGdhaW5Ob2RlLmdhaW4udmFsdWUgPSBkYXRhQ2VudGVyLmdhbWVDb25maWd1cmF0aW9uLnNvdW5kVm9sdW1lOwogICAgICBhdWRpby52b2x1bWUgPSBkYXRhQ2VudGVyLmdhbWVDb25maWd1cmF0aW9uLnNvdW5kVm9sdW1lOwogICAgICBhdWRpby5wbGF5KCk7CiAgICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICBhdWRpby5vbmNhbnBsYXkgPSAoKSA9PiB7CiAgICAgICAgICBlbnRpdHkubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgZW50aXR5LnN1Y2Nlc3MgPSB0cnVlOwogICAgICAgICAgcmVzb2x2ZShlbnRpdHkpOwogICAgICAgIH07CiAgICAgICAgYXVkaW8ub25lcnJvciA9ICgpID0+IHsKICAgICAgICAgIGVudGl0eS5sb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICByZXNvbHZlKGVudGl0eSk7CiAgICAgICAgfTsKICAgICAgICBpZiAoYXVkaW8ucmVhZHlTdGF0ZSA9PT0gNCkgewogICAgICAgICAgcmVzb2x2ZShlbnRpdHkpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGNvbnN0IGVudGl0eSA9IHsKICAgICAgICBlbGVtZW50OiBhdWRpbywKICAgICAgICBwcm9taXNlLAogICAgICAgIHN1Y2Nlc3M6IGZhbHNlLAogICAgICAgIGxvYWRpbmc6IHRydWUKICAgICAgfTsKICAgICAgdGhpcy5tYXBbdXJsXSA9IGVudGl0eTsKICAgICAgcmV0dXJuIHByb21pc2U7CiAgICB9OwogIH0KICBsb2FkUmVzb3VyY2VzKHVybHMpIHsKICAgIGNvbnN0IHdhaXRMaXN0ID0gdXJscy5maWx0ZXIodXJsID0+ICF0aGlzLm1hcFt1cmxdIHx8ICF0aGlzLm1hcFt1cmxdLnN1Y2Nlc3MpOwogICAgd2FpdExpc3QubWFwKHRoaXMubG9hZFNvdW5kKTsKICB9CiAgcGxheSh1cmwsIHRpbWVzID0gMSkgewogICAgcmV0dXJuIHRoaXMubG9hZFNvdW5kKHVybCkudGhlbihlbnRpdHkgPT4gewogICAgICBjb25zdCBhdWRpbyA9IGVudGl0eS5lbGVtZW50OwogICAgICBhdWRpby5wYXVzZSgpOwogICAgICBpZiAodGltZXMgPiAxKSB7CiAgICAgICAgYXVkaW8ubG9vcCA9IHRydWU7CiAgICAgIH0KICAgICAgYXVkaW8ucGxheSgpOwogICAgICB0aGlzLl9rZWVwQWxpdmVzLnB1c2goYXVkaW8pOwogICAgICBjb25zdCBzdG9wID0gKCkgPT4gewogICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fa2VlcEFsaXZlcy5pbmRleE9mKGF1ZGlvKTsKICAgICAgICBpZiAoaW5kZXggPj0gMCkgewogICAgICAgICAgdGhpcy5fa2VlcEFsaXZlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgICBhdWRpby5wYXVzZSgpOwogICAgICB9OwogICAgICBhdWRpby5vbmVuZGVkID0gKCkgPT4gewogICAgICAgIHRpbWVzLS07CiAgICAgICAgaWYgKHRpbWVzIDw9IDApIHsKICAgICAgICAgIHN0b3AoKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGNvbnN0IHBsYXllciA9IHsKICAgICAgICBhdWRpbywKICAgICAgICBzdG9wLAogICAgICAgIHBhdXNlOiAoKSA9PiB7CiAgICAgICAgICBhdWRpby5wYXVzZSgpOwogICAgICAgIH0sCiAgICAgICAgcmVzdW1lKCkgewogICAgICAgICAgYXVkaW8ucGxheSgpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgLy8g5a2Y5YKoIFNvdW5kUGxheWVyIOWvueixoQogICAgICB0aGlzLl9hY3RpdmVQbGF5ZXJzLnB1c2gocGxheWVyKTsKICAgICAgcmV0dXJuIHBsYXllcjsKICAgIH0pOwogIH0KICAvKirmlrDlop7vvJrlgZzmraLmiYDmnInpn7PpopEgKi8KICBzdG9wQWxsKCkgewogICAgdGhpcy5fYWN0aXZlUGxheWVycy5mb3JFYWNoKHBsYXllciA9PiBwbGF5ZXIuc3RvcCgpKTsKICAgIHRoaXMuX2FjdGl2ZVBsYXllcnMgPSBbXTsKICB9CiAgLyoq5paw5aKe77ya5pqC5YGc5omA5pyJ6Z+z6aKRICovCiAgcGF1c2VBbGwoKSB7CiAgICB0aGlzLl9hY3RpdmVQbGF5ZXJzLmZvckVhY2gocGxheWVyID0+IHBsYXllci5wYXVzZSgpKTsKICB9Cn0KZXhwb3J0IGNvbnN0IHNvdW5kTWFuYWdlciA9IG5ldyBTb3VuZE1hbmFnZXIoKTs="},{"version":3,"names":["dataCenter","SoundManager","constructor","map","_keepAlives","_activePlayers","loadSound","url","loadingPromise","loading","promise","audio","Audio","audioContext","AudioContext","gainNode","createGain","connect","destination","gain","value","gameConfiguration","soundVolume","volume","play","Promise","resolve","oncanplay","entity","success","onerror","readyState","element","loadResources","urls","waitList","filter","times","then","pause","loop","push","stop","index","indexOf","splice","onended","player","resume","stopAll","forEach","pauseAll","soundManager"],"sources":["/Users/nuomi/Desktop/项目/concept/web3-concept/node_modules/eslint-loader/index.js??ref--14-0!/Users/nuomi/Desktop/项目/concept/web3-concept/src/manager/SoundManager.ts"],"sourcesContent":["import dataCenter from '@/dataCenter';\n\ninterface SoundEntity {\n  element: HTMLAudioElement;\n  promise: Promise<SoundEntity>;\n  success?: boolean;\n  loading?: boolean;\n}\nexport interface SoundPlayer {\n  audio: HTMLAudioElement;\n  stop: () => void;\n  pause: () => void;\n  resume: () => void;\n}\nclass SoundManager {\n  private map: Record<string, SoundEntity> = {};\n  private _keepAlives: HTMLAudioElement[] = [];\n  /**新增：存储所有 SoundPlayer 对象 */\n  private _activePlayers: SoundPlayer[] = [];\n  loadResources(urls: string[]) {\n    const waitList = urls.filter(\n      (url) => !this.map[url] || !this.map[url].success,\n    );\n    waitList.map(this.loadSound);\n  }\n  play(url: string, times = 1) {\n    return this.loadSound(url).then((entity) => {\n      const audio = entity.element;\n      audio.pause();\n      if (times > 1) {\n        audio.loop = true;\n      }\n      audio.play();\n      this._keepAlives.push(audio);\n      const stop = () => {\n        const index = this._keepAlives.indexOf(audio);\n        if (index >= 0) {\n          this._keepAlives.splice(index, 1);\n        }\n        audio.pause();\n      };\n      audio.onended = () => {\n        times--;\n        if (times <= 0) {\n          stop();\n        }\n      };\n      const player: SoundPlayer = {\n        audio,\n        stop,\n        pause: () => {\n          audio.pause();\n        },\n        resume() {\n          audio.play();\n        },\n      };\n      // 存储 SoundPlayer 对象\n      this._activePlayers.push(player);\n      return player;\n    });\n  }\n  private loadSound = (url: string) => {\n    const loadingPromise = this.map[url];\n    if (loadingPromise && loadingPromise.loading) {\n      return loadingPromise.promise;\n    }\n    const audio = new Audio(url);\n    const audioContext = new AudioContext();\n    const gainNode = audioContext.createGain();\n    gainNode.connect(audioContext.destination);\n    // 设置音量\n    gainNode.gain.value = dataCenter.gameConfiguration.soundVolume;\n    audio.volume = dataCenter.gameConfiguration.soundVolume;\n    audio.play();\n    const promise = new Promise<SoundEntity>((resolve) => {\n      audio.oncanplay = () => {\n        entity.loading = false;\n        entity.success = true;\n        resolve(entity);\n      };\n      audio.onerror = () => {\n        entity.loading = false;\n        resolve(entity);\n      };\n      if (audio.readyState === 4) {\n        resolve(entity);\n      }\n    });\n    const entity: SoundEntity = {\n      element: audio,\n      promise,\n      success: false,\n      loading: true,\n    };\n    this.map[url] = entity;\n    return promise;\n  };\n  /**新增：停止所有音频 */\n  stopAll() {\n    this._activePlayers.forEach((player) => player.stop());\n    this._activePlayers = [];\n  }\n  /**新增：暂停所有音频 */\n  pauseAll() {\n    this._activePlayers.forEach((player) => player.pause());\n  }\n}\n\nexport const soundManager = new SoundManager();\n"],"mappings":"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"}]}